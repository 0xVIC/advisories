# CVE-2018-12483: Remote Command Execution in OCS Inventory
[![](https://img.shields.io/badge/Attack%20Vector-Remote-red?style=flat-square)]() [![](https://img.shields.io/badge/Privileges%20Required-None-red?style=flat-square)]() [![](https://img.shields.io/badge/User%20Interaction-No-red?style=flat-square)]()


__Vendor:__ OCS Inventory<br>
__Vendor URL:__ https://ocsinventory-ng.org<br>
__Versions affected:__ OCS Inventory <= 2.4.1<br>
__Discovered by:__ Jaume Llopis ([@JKS___](https://twitter.com/JKS___))<br>
__Public fix:__ Yes<br>
__Proof of Concept:__ No <br>

## Summary
An authenticated attacker can execute system commands via command injection in IP Discover functionality.

## Details
In IP Discovery functionality:
```php
function runCommand($command = "", $fname) {
    $command = "perl ipdiscover-util.pl $command -xml -h=" . SERVER_READ . " -u=" . COMPTE_BASE . " -p=" . PSWD_BASE . " -d=" . DB_NAME . " -path=" . $fname;
    exec($command);
}
```
The perl script is executed as a system command via exec() function, where it takes as argument a text string where the parameters have been concatenated:
```php 
//ms_ipdiscover_analyse.php
$pas = $protectedGet['rzo'];
$values = look_config_default_values(array('IPDISCOVER_IPD_DIR'), '', array('IPDISCOVER_IPD_DIR' => array('TVALUE' => VARLIB_DIR)));
$fname = $values['tvalue']['IPDISCOVER_IPD_DIR'];
$file_name = $fname . "/ipd/" . $pas . ".ipd";
//reset cache?
if (is_defined($protectedPost['reset'])) {
    unlink($file_name);
    reloadform_closeme('', true);
} else {
    if (!is_readable($file_name))
        runCommand("-cache -net=" . $pas, $fname);
```
The parameters provided to the runCommand function lack any filtering, so it is possible to abuse this functionality in order to execute arbitrary commands in the OS. Since we have the control of $pas (as it acquires its value from the GET parameter “rzo”), we can insert commands by the creation of a string like this one:

```bash
perl ipdiscover-util.pl -cache -net=;id > /tmp/pwned;#-xml -h=...
```
## Impact
An authenticated attacker can execute arbitrary system commands. This can be exploited inside the a valid session via CSRF.

## Recommendation
Update to last version.

## Timeline

* 05/06/2018 - Reported vulnerability to vendor
* 05/06/2018 - Vendor ACK
* 14/06/2018 - First fix attempt (bypassed)
* 02/07/2018 - Correct fix
* 30/07/2018 - Security Release with fix (OCS Inventory 2.5)


#

[![](https://img.shields.io/badge/www-blackarrow.net-E5A505?style=flat-square)](https://www.blackarrow.net) [![](https://img.shields.io/badge/twitter-@BlackArrowSec-00aced?style=flat-square&logo=twitter&logoColor=white)](https://twitter.com/BlackArrowSec) [![](https://img.shields.io/badge/linkedin-@BlackArrowSec-0084b4?style=flat-square&logo=linkedin&logoColor=white)](https://www.linkedin.com/company/blackarrowsec/)