# CVE-2018-12482: Multiple SQL injections in OCS Inventory
[![](https://img.shields.io/badge/Attack%20Vector-Remote-red?style=flat-square)]() [![](https://img.shields.io/badge/Privileges%20Required-Low-red?style=flat-square)]() [![](https://img.shields.io/badge/User%20Interaction-No-red?style=flat-square)]()


__Vendor:__ OCS Inventory<br>
__Vendor URL:__ https://ocsinventory-ng.org<br>
__Versions affected:__ OCS Inventory <= 2.4.1<br>
__Discovered by:__ Pablo Martinez ([@xassiz](https://twitter.com/Xassiz)), Jaume Llopis ([@JKS___](https://twitter.com/JKS___)) & Juan Manuel Fernandez ([@TheXC3LL](https://twitter.com/TheXC3LL))<br>
__Public fix:__ Yes<br>
__Proof of Concept:__ No <br>


## Summary
The search engine implemented in OCS Inventory does not perform an adequate filtering of the parameters used within SQL statements, making it possible to inject arbitrary SQL code.

## Details
Some injection points:

* GET and POST parameter “values” when searching from the section “Inventory -> Search with various criteria data”. When you select a search tag (for example “Network: IPADDRESS”), the SQL statement remains such that:
```
select distinct HARDWARE_ID,networks.DESCRIPTION as 'Network: Description',networks.TYPE as 'Network: Type',networks.TYPEMIB as 'Network: MibType',networks.SPEED as 'Network: Speed',networks.MACADDR as 'Network: MAC Address',networks.STATUS as 'Network: Status',networks.IPADDRESS as 'Network: IP Address',networks.IPMASK as 'Network: IP Netmask',networks.IPSUBNET as 'Network: Subnetwork IP',networks.IPGATEWAY as 'Network: Gateway IP',networks.IPDHCP as 'Network: DHCP IP' from networks where ( ( IPADDRESS = '[INJECT HERE]'))
```

By not filtering properly, we can break the sentence with a single quote (‘) and inject our payload.

* Parameters length, order and start. These parameters used for the limit and order clauses of the SQL statement are not filtered properly, allowing the execution of arbitrary queries in the same way:
```
(Example: POST parameter length)
... GROUP BY netid) non_ident on non_ident.RSX=inv.RSX) toto order by ID asc limit 0 ,[inject here]
```
## Impact
An attacker can execute arbitrary SQL queries in the backend.

## Recommendation
Update the software to last version.

## Timeline

* 05/06/2018 - Reported vulnerability to vendor
* 05/06/2018 - Vendor ACK
* 14/06/2018 - First fix attempt (bypassed)
* 02/07/2018 - Correct fix
* 30/07/2018 - Security Release with fix (OCS Inventory 2.5)


#

[![](https://img.shields.io/badge/www-blackarrow.net-E5A505?style=flat-square)](https://www.blackarrow.net) [![](https://img.shields.io/badge/twitter-@BlackArrowSec-00aced?style=flat-square&logo=twitter&logoColor=white)](https://twitter.com/BlackArrowSec) [![](https://img.shields.io/badge/linkedin-@BlackArrowSec-0084b4?style=flat-square&logo=linkedin&logoColor=white)](https://www.linkedin.com/company/blackarrowsec/)
